---

- hosts: elk-postgres
  become: true
  vars_files:
    - vars.yml


  tasks:

  - name: Load the Filebeat dashboard
    command: >
      filebeat setup -E setup.kibana.host={{ elastic_host }}:5601 -E output.elasticsearch.hosts=[{{ elastic_host }}:9200]

  - name: Load the Heartbeat dashboard
    command: >
      heartbeat setup -E setup.kibana.host={{ elastic_host }}:5601 -E output.elasticsearch.hosts=[{{ elastic_host }}:9200]

  - name: Load the Metricbeat dashboard
    command: >
      metricbeat setup -E setup.kibana.host={{ elastic_host }}:5601 -E output.elasticsearch.hosts=[{{ elastic_host }}:9200]

  - name: Load the Packetbeat dashboard
    command: >
      
      packetbeat setup -E setup.kibana.host={{ elastic_host }}:5601 -E output.elasticsearch.hosts=[{{ elastic_host }}:9200]

  - name: Add a default index pattern using Metricbeat
    command: >
      curl -XPUT "http://{{ elastic_host }}:9200/.kibana/config/{{ elastic_version }}"
           -u "{{ elastic_user }}:{{ elastic_password }}"
           -H "Content-Type: application/json"
           -d '{"defaultIndex" : "metricbeat-*"}'
